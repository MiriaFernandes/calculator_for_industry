{% extends "base.html" %}

{% block title %}Início{% endblock %}

{% block content %}
<div class="relative w-screen mx-[calc(50%-50vw)] overflow-x-clip">

    <!-- Banner -->
    <section class="w-full pt-24">
        <div class="px-4 sm:px-6 lg:px-12">
            <div class="rounded-2xl overflow-hidden bg-gradient-to-r from-red-700 via-red-600 to-neutral-900 shadow">
                <div class="flex  justify-center justify-around  gap-6 px-6 py-10">
                    <div class="col-span-12 md:col-span-3 flex justify-center md:justify-start">
                        <img src="/static/image/illustration-upload.svg" alt="Ilustração nota fiscal"
                            class="h-28 sm:h-36 md:h-40 w-auto">
                    </div>
                    <div class="col-span-12 md:col-span-9 text-center md:text-left">
                        <h2 class="text-white text-xl sm:text-2xl md:text-3xl font-semibold leading-snug">
                            TRANSFORME SUA <span class="font-extrabold">NOTA FISCAL</span><br class="hidden sm:block" />
                            EM INFORMAÇÕES VALIOSAS
                        </h2>
                    </div>
                </div>
            </div>

         
            <form id="uploadForm" class="mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 px-6">

                <!-- campo de seleção -->
                <div class="flex-1 flex items-center gap-3">
                    <label for="xmlFile"
                        class="cursor-pointer rounded-full bg-neutral-800 px-6 py-2 text-white text-sm font-semibold shadow hover:bg-neutral-700">
                        Escolher Arquivo
                    </label>

                    <input id="xmlFile" type="file" accept=".xml" class="sr-only">
                </div>

               </form>
        </div>
    </section>

    <!-- Card branco -->
    <section class="w-full py-6">
        <div class="px-4 sm:px-6 lg:px-12">
            <div class="relative rounded-2xl bg-white shadow p-8 min-h-[300px]">

                <!-- Estado inicial -->
                <!-- <div id="emptyState" class="text-center">
                    <h3 class="text-5xl font-extrabold tracking-widest text-red-200">MCM</h3>
                    <p class="text-2xl font-semibold tracking-widest text-red-200">BOBINAS</p>
                </div> -->

                <!-- Itens da Nota -->
                <div id="itensContainer" class="hidden w-full">

                    <!-- Linha de botões de ação -->
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex gap-3">
                            <!-- <button id="btnCriarProduto"
                                class="rounded-full bg-neutral-700 px-4 py-2 text-sm text-white hover:bg-neutral-600">
                                Criar Novo Produto
                            </button> -->
                            <button id="btnFecharNota"
                                class="hidden rounded-full bg-neutral-700 px-4 py-2 text-sm text-white hover:bg-neutral-600">
                                x                            </button>
                        </div>

                    </div>

                    <!-- Tabela -->
                    <div class="overflow-x-auto">
                        <table id="itensTable" class="min-w-full text-sm">
                            <thead>
                                <tr class="text-neutral-600 border-b">
                                    <th class="px-4 py-3 text-left">Código</th>
                                    <th class="px-4 py-3 text-left">Data Emissão</th>
                                    <th class="px-4 py-3 text-left">Descrição</th>
                                    <th class="px-4 py-3 text-left">Unidade</th>
                                    <th class="px-4 py-3 text-left">Valor Unitário</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- preenchido via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Loader -->
                <div id="loading" class="hidden absolute inset-0 bg-white/70 grid place-items-center">
                    <div class="h-10 w-10 rounded-full border-2 border-red-600 border-t-transparent animate-spin"></div>
                </div>
            </div>

            <!-- Botão cadastrar -->
            <div class="mt-6 flex justify-center">
                <button type="button" id="btnEnviarItens"
                    class="rounded-full bg-red-600 px-6 py-2 text-white text-sm font-semibold shadow hover:bg-red-700">
                    CADASTRAR NOTA FISCAL
                </button>
            </div>
        </div>
    </section>

    <!-- Produtos Criados -->
    <section id="produtosCriados" class="w-full py-6 hidden">
        <div class="px-4 sm:px-6 lg:px-12">
            <h2 class="text-lg font-semibold mb-4">Produtos Criados Recentemente</h2>
            <div id="produtosList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>
    </section>

    <!-- Modal duplicata -->
    <div id="modalDuplicata" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="text-lg font-bold mb-2">Não foi possível enviar</h3>
            <p class="mb-4">Foram encontrados itens já cadastrados com o mesmo <strong>valor_unitário</strong> e
                <strong>data_emissão</strong>:
            </p>
            <ul id="modalLista" class="list-disc pl-5 text-sm mb-4"></ul>
            <button id="modalFechar" class="mt-2 rounded bg-red-600 px-4 py-2 text-white hover:bg-red-700">
                Entendi
            </button>
        </div>
    </div>

    <!-- Modal fechar nota -->
    <div id="nfCloseModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50"
        aria-hidden="true" role="dialog" aria-modal="true">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="text-lg font-bold mb-2">Fechar Nota Fiscal?</h3>
            <p class="mb-4">Isso vai limpar a tabela e remover os itens salvos desta NF.</p>
            <div class="flex justify-end gap-3">
                <button id="nfCloseCancel"
                    class="rounded bg-neutral-300 px-4 py-2 text-sm hover:bg-neutral-400">Cancelar</button>
                <button id="nfCloseConfirm"
                    class="rounded bg-red-600 px-4 py-2 text-sm text-white hover:bg-red-700">Fechar</button>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script>
    const emptyState = document.getElementById("emptyState");
    const itensContainer = document.getElementById("itensContainer");
    const itensTable = document.getElementById("itensTable");

    // função para verificar e alternar
    function atualizarEstadoCard() {
        const tbody = itensTable.querySelector("tbody");
        if (tbody && tbody.children.length > 0) {
            // se tem linhas na tabela → esconde logo e mostra tabela
            emptyState.classList.add("hidden");
            itensContainer.classList.remove("hidden");
        } else {
            // se não tem linhas → mostra logo e esconde tabela
            emptyState.classList.remove("hidden");
            itensContainer.classList.add("hidden");
        }
    }

    // chame a função logo no início
    atualizarEstadoCard();

    // se o seu código já adiciona linhas no tbody,
    // chame atualizarEstadoCard() logo depois de inserir as linhas
    window.atualizarEstadoCard = atualizarEstadoCard;
</script>
<script type="module" src="/static/js/pages/index.js"></script>

{% endblock %}